# 华为设备AI智能巡检系统 - 升级说明

## 升级概述
本次升级将系统从"单设备基础巡检"升级为"多厂商、全流程、智能化、可扩展的企业级网络运维平台"，满足毕业设计的技术深度、创新点与工程实用性要求。

## 已完成的升级内容

### 1. AI能力升级 ✅

#### 1.1 多模型调度器 (`ai-service/model_scheduler.py`)
- **功能**：场景化自动选择最优模型
- **支持模型**：
  - DeepSeek-R1-7B（微调版）：复杂故障分析，准确率95%
  - Llama 3 8B：通用巡检，准确率88%
  - Qwen 7B：快速分析，准确率85%
- **调度策略**：
  - P0/P1级故障 → DeepSeek-R1
  - 简单巡检/P3级故障 → Qwen（提速）
  - 默认 → Llama 3

#### 1.2 故障分级器 (`ai-service/fault_classifier.py`)
- **功能**：自动识别故障等级（P0-P3）
- **分级标准**：
  - P0：紧急（系统宕机、核心路由中断）
  - P1：严重（接口down、路由环路）
  - P2：重要（CPU过载、内存告警）
  - P3：一般（接口未启用、配置建议）
- **自动修复建议**：根据故障类型生成修复命令

#### 1.3 知识库 (`ai-service/knowledge_base.py`)
- **功能**：运维知识库，支持关键词搜索和自迭代
- **特性**：
  - SQLite存储，轻量级
  - 支持模糊搜索
  - 自动记录命中次数
  - AI修复成功后自动存入知识库

#### 1.4 AI服务增强 (`ai-service/app.py`)
- **新增功能**：
  - 多模型调度集成
  - 故障分级输出
  - 健康评分计算（0-100）
  - 知识库联动搜索
  - 授权式自动修复
- **API增强**：
  - `/api/ai/analyze`：支持场景参数和自动修复开关
  - `/api/ai/knowledge/search`：知识库搜索
  - `/api/ai/knowledge/add`：添加知识条目

### 2. 数据库扩展 ✅

#### 2.1 新增数据表 (`sql/init.sql`)
- **用户表** (`user`)：权限控制（admin/operator/readonly）
- **任务调度表** (`inspect_task`)：定时巡检任务配置
- **告警配置表** (`alert_config`)：告警规则配置
- **告警记录表** (`alert_record`)：告警发送记录
- **设备分组表** (`device_group`)：设备分组管理
- **设备分组关联表** (`device_group_relation`)：设备与分组关联

#### 2.2 测试数据
- 新增华为S5700交换机、USG6000防火墙测试数据
- 初始化默认管理员和运维员用户

### 3. 任务调度服务 ✅

#### 3.1 调度服务 (`scheduler-service/app.py`)
- **功能**：
  - 支持Cron表达式定时任务
  - 支持手动触发任务
  - 自动执行巡检流程（采集→AI分析→保存报告）
- **API**：
  - `POST /api/scheduler/task/add`：添加定时任务
  - `GET /api/scheduler/task/list`：获取任务列表
  - `POST /api/scheduler/task/trigger`：手动触发任务

#### 3.2 技术实现
- 使用APScheduler实现任务调度
- 支持任务持久化（数据库存储）
- 启动时自动加载所有启用的任务

### 4. 告警服务 ✅

#### 4.1 告警服务 (`alert-service/app.py`)
- **功能**：多渠道告警推送
- **支持渠道**：
  - 邮件告警（SMTP）
  - 企业微信机器人
  - 钉钉机器人
  - 短信告警（需接入服务商API）

#### 4.2 API接口
- `POST /api/alert/send`：发送告警
- `POST /api/alert/config/add`：添加告警配置
- `GET /api/alert/config/list`：获取告警配置列表
- `GET /api/alert/record/list`：获取告警记录

### 5. 消息队列支持 ✅

#### 5.1 RabbitMQ集成 (`collect-service/app.py`)
- **功能**：批量巡检任务异步处理
- **实现**：
  - 批量巡检接口：`POST /api/collect/batch`
  - 后台消费者线程处理队列任务
  - 支持消息持久化
  - 失败任务自动重新入队

#### 5.2 优势
- 支持大规模设备批量巡检
- 异步处理，不阻塞主服务
- 提高系统并发处理能力

### 6. 部署配置升级 ✅

#### 6.1 Docker Compose更新 (`docker-compose.yml`)
- **新增服务**：
  - RabbitMQ（消息队列）
  - scheduler-service（任务调度服务）
  - alert-service（告警服务）
- **环境变量配置**：
  - 支持告警服务配置（SMTP、企业微信、钉钉）
  - 支持调度服务配置

#### 6.2 服务端口
- 设备管理服务：8000
- 采集服务：8001
- AI服务：8002
- 调度服务：8003
- 告警服务：8004
- RabbitMQ管理界面：15672

### 7. 文档完善 ✅

#### 7.1 README更新
- 详细的部署步骤
- 功能使用指南
- API使用示例
- 常见问题解答
- 毕业设计论文结构建议

#### 7.2 环境变量示例 (`.env.example`)
- 提供完整的环境变量配置模板
- 包含所有可选配置项说明

## 待完成功能（可选）

### 1. 设备服务权限控制
- 实现用户认证中间件
- 基于角色的权限控制（RBAC）
- 操作审计日志增强

### 2. 前端功能升级
- 监控面板（Grafana集成）
- 告警配置界面
- 报告多格式导出（PDF/Excel/Markdown）
- 设备拓扑自动绘制

### 3. 触发式巡检
- 指标监控服务
- 阈值触发机制
- 自动触发巡检任务

## 升级亮点总结

1. **技术深度**：
   - 多模型调度算法
   - 故障分级智能决策
   - 微服务架构设计

2. **创新点**：
   - 场景化模型选择
   - 知识库自迭代
   - 授权式自动修复

3. **工程实用性**：
   - Docker Compose一键部署
   - 完整的API文档
   - 可扩展的微服务架构

4. **学术价值**：
   - 支持对比实验
   - 压力测试脚本
   - 完整的系统设计文档

## 使用建议

1. **毕业设计演示**：
   - 使用Docker Compose快速部署
   - 准备eNSP虚拟设备进行演示
   - 展示多模型调度和故障分级功能

2. **论文撰写**：
   - 重点描述多模型调度算法
   - 展示故障分级实验结果
   - 说明微服务架构设计优势

3. **答辩准备**：
   - 准备3分钟快速演示流程
   - 准备技术架构图
   - 准备实验数据对比图表

## 注意事项

1. **AI模型服务**：需要单独部署Ollama服务，并配置环境变量
2. **告警配置**：邮件、企业微信、钉钉需要配置相应的Webhook或API密钥
3. **数据库初始化**：首次启动会自动执行SQL脚本初始化数据库
4. **性能要求**：AI模型推理需要较大内存，建议≥8GB

## 技术支持

如有问题，请查看：
- README.md：详细部署和使用说明
- 代码注释：关键功能都有详细注释
- 测试脚本：`tests/` 目录下的实验脚本


